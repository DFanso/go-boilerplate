// Code generated by goa v3.23.4, DO NOT EDIT.
//
// identity gRPC server types
//
// Command:
// $ goa gen github.com/vidwadeseram/go-boilerplate/identity-api/design

package server

import (
	"unicode/utf8"

	identitypb "github.com/vidwadeseram/go-boilerplate/identity-api/gen/grpc/identity/pb"
	identity "github.com/vidwadeseram/go-boilerplate/identity-api/gen/identity"
	identityviews "github.com/vidwadeseram/go-boilerplate/identity-api/gen/identity/views"
	goa "goa.design/goa/v3/pkg"
)

// NewRegisterPayload builds the payload of the "register" endpoint of the
// "identity" service from the gRPC request type.
func NewRegisterPayload(message *identitypb.RegisterRequest) *identity.RegisterPayload {
	v := &identity.RegisterPayload{
		DisplayName: message.DisplayName,
		Email:       message.Email,
		Password:    message.Password,
	}
	return v
}

// NewProtoRegisterResponse builds the gRPC response type from the result of
// the "register" endpoint of the "identity" service.
func NewProtoRegisterResponse(result *identityviews.UserView) *identitypb.RegisterResponse {
	message := &identitypb.RegisterResponse{
		Id:          *result.ID,
		Email:       *result.Email,
		DisplayName: *result.DisplayName,
		CreatedAt:   *result.CreatedAt,
	}
	return message
}

// NewLoginPayload builds the payload of the "login" endpoint of the "identity"
// service from the gRPC request type.
func NewLoginPayload(message *identitypb.LoginRequest) *identity.Credentials {
	v := &identity.Credentials{
		Email:    message.Email,
		Password: message.Password,
	}
	return v
}

// NewProtoLoginResponse builds the gRPC response type from the result of the
// "login" endpoint of the "identity" service.
func NewProtoLoginResponse(result *identity.TokenResult) *identitypb.LoginResponse {
	message := &identitypb.LoginResponse{
		AccessToken: result.AccessToken,
		ExpiresIn:   int32(result.ExpiresIn),
	}
	return message
}

// NewValidateTokenPayload builds the payload of the "validate_token" endpoint
// of the "identity" service from the gRPC request type.
func NewValidateTokenPayload(message *identitypb.ValidateTokenRequest) *identity.ValidateTokenPayload {
	v := &identity.ValidateTokenPayload{
		Token: message.Token,
	}
	return v
}

// NewProtoValidateTokenResponse builds the gRPC response type from the result
// of the "validate_token" endpoint of the "identity" service.
func NewProtoValidateTokenResponse(result *identity.ValidationResult) *identitypb.ValidateTokenResponse {
	message := &identitypb.ValidateTokenResponse{
		Valid:  result.Valid,
		UserId: result.UserID,
		Email:  result.Email,
		Reason: result.Reason,
	}
	return message
}

// ValidateRegisterRequest runs the validations defined on RegisterRequest.
func ValidateRegisterRequest(message *identitypb.RegisterRequest) (err error) {
	if utf8.RuneCountInString(message.DisplayName) < 3 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.display_name", message.DisplayName, utf8.RuneCountInString(message.DisplayName), 3, true))
	}
	err = goa.MergeErrors(err, goa.ValidateFormat("message.email", message.Email, goa.FormatEmail))
	if utf8.RuneCountInString(message.Password) < 8 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.password", message.Password, utf8.RuneCountInString(message.Password), 8, true))
	}
	return
}

// ValidateLoginRequest runs the validations defined on LoginRequest.
func ValidateLoginRequest(message *identitypb.LoginRequest) (err error) {
	err = goa.MergeErrors(err, goa.ValidateFormat("message.email", message.Email, goa.FormatEmail))
	if utf8.RuneCountInString(message.Password) < 8 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.password", message.Password, utf8.RuneCountInString(message.Password), 8, true))
	}
	return
}
